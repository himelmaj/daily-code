---
import { getCollection } from "astro:content";
import DayItem from "./DayItem.astro";

const days = await getCollection("days");
---

<section class="day-list opacity-0" transition:persist>
    {
        days.map(({ data: { title }, slug }) => (
            <DayItem title={title} slug={slug} className="day-link border-x-0"/>
        ))
    }
</section>

<script>
    import { animate, hover, stagger } from "motion";
    import { scrambleText } from "motion-plus-dom";
    
    function initAnimations() {
        
        const container = document.querySelector(".day-list");
        const links = document.querySelectorAll<HTMLAnchorElement>(".day-link");
        
        if (container && links.length > 0) {
            animate(container, { opacity: 1 }, { duration: 0.3 });
            animate(links, { opacity: 1 }, { delay: stagger(0.08) });
            
            links.forEach((link) => {
                const texts = link.querySelectorAll<HTMLElement>(".scramble");
                
                texts.forEach((el) => {
                    if (!el.dataset.original) {
                        el.dataset.original = el.textContent ?? "";
                    }
                });
                
                hover(link, () => {
                    const animations = Array.from(texts).map((el, i) => {
                        el.textContent = el.dataset.original ?? "";
                        
                        return scrambleText(el, {
                            duration: 1,
                            delay: i * 0.05,
                        });
                    });
                    
                    return () => {
                        animations.forEach((a) => a.finish());
                        texts.forEach((el) => {
                            el.textContent = el.dataset.original ?? "";
                        });
                    };
                });
            });
        }
    }
    
    initAnimations();
    
    document.addEventListener('astro:page-load', initAnimations);
</script>